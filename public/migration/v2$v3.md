# MIGRATION GUIDE: API_v2 --> API_v3

@author: sjoseph7  
@created: 20 June 2020

This version bump resulted from a move to auth0 compatibility. 

Resource changes:

- All previous 'auth' resources (`auth`, `users`) were deprecated.
- `courses` resource was deprecated.
- `people` can now belong to multiple `region`s
- `people` no longer have "coursesAsInstructor" or "coursesAsStudent" properties (because courses are deprecated)

## Resources

---

### Announcements

_This resource represents region- or student-specific `announcement`s at the top of the student portal. As long as this resource exists in the database, the `announcement` will be present._

**Schema** [NO CHANGE]

```ts
{
  title: "WELCOME_ANNOUNCEMENT_LA",
  message: "Welcome to LA!",
  regions: ["6dc4fc8194f68a3cbc7c69a1"],
  recipients: []
}
```

| Property   | Type          | Description                                                    |
| ---------- | ------------- | -------------------------------------------------------------- |
| title      | string        | Admin-friendly name for the `announcement`                     |
| message    | string        | The actual message that shows up on the student portal         |
| regions    | [ objectIds ] | List of `region`s that should see the `announcement`           |
| recipients | [ objectIds ] | List of _specific_ `people` that should see the `announcement` |

_NOTE: the `region` and recipient fields operate on order of increased specificity. If an `announcement` targets an entire `region`, leave the recipients array empty - if any recipient is listed, the `announcement` will only go to the listed recipient(s)._

---

### People

_This resource is used to quickly populate queries for `schedule-item`s with names of students and instructors_

**Schema** [One (1) CHANGE]

- region -> regions

```ts
{
  firstName: "John",
  lastName: "Doe",
  username: "john_doe_123",
  type: "student",
  regions: ["6dc4fc8194f68a3cbc7c69a1"]
}
```

| Property                       | Type                               | Description                                                                                                 |
| ------------------------------ | ---------------------------------- | ----------------------------------------------------------------------------------------------------------- |
| firstName                      | string                             | User's given_name                                                                                           |
| lastName                       | string                             | User's family_name                                                                                          |
| username                       | string                             | User's username                                                                                             |
| type                           | string                             | Type of user (student, instructor, admin)                                                                   |
| ~~region~~                     | ~~objectId~~                       | **(Deprecated, replaced by `regions`)**                                                                     |
| regions                        | [ objectIds ]                      | User's operating `region`(s)                                                                                |
| ~~coursesAsInstructor~~        | ~~[ objectIds ]~~                  | **(Deprecated because courses have been deprecated)**                                                       |
| ~~coursesAsStudent~~           | ~~[ objectIds ]~~                  | **(Deprecated because courses have been deprecated)**                                                       |
| \*\*scheduleItemsAsHost        | [ objectIds ] (\*\*virtual getter) | `schedule-item`s hosted by this person (automatically populated as `schedule-item`s)                        |
| \*\*scheduleItemsAsParticipant | [ objectIds ] (\*\*virtual getter) | `schedule-item`s where this person is listed as a participant (automatically populated as `schedule-item`s) |

_NOTE: When something needs to render `region` specific content, the first `region` in the array is used._

---

### Region

_This resource maintains `region` specific site content._

**Schema** [NO CHANGE]

```ts
{
  name: "DISCOVERY_LA",
  address: "123 Main St., Los Angeles, Ca",
  siteContent: {
    title: "Welcome to BEAM LA!",
    subTitle: "We're so excited you're here",
    links: [{
      text: "Zulip Chat",
      type: "helpful",
      url: "http://zulip.com/chat-link",
    }],
  }
}
```

| Property                  | Type        | Description                                         |
| ------------------------- | ----------- | --------------------------------------------------- |
| name                      | string      | Human-friendly name of `region` (e.g. DISCOVERY_LA) |
| address                   | string      | Address of BEAM site                                |
| siteContent               | object      | Grouping of site content                            |
| _siteContent_.title       | string      | Main header site message                            |
| _siteContent_.subTitle    | string      | Sub-header site message                             |
| _siteContent_.links       | [ objects ] | Grouping of site links                              |
| _siteContent_._link_.text | string      | Link text                                           |
| _siteContent_._link_.type | string      | Type of link (helpful, need-help)                   |
| _siteContent_._link_.url  | string      | Link url                                            |

---

### ScheduleItems

_This resource represents an item on a `person` or `people`'s schedule(s) within a specific `region`._

**Schema** [NO CHANGE]

```ts
{
  name: "Open Math Time",
  description: "Math is fun!",
  note: "Optional the first week, required for the rest of the program"
  region: "6dc4fc8194f68a3cbc7c69a1"
  days: ["monday", "tuesday", "thursday", "friday"],
  startTime: {
    hour: 9,
    minute: 35
  },
  endTime: {
    hour: 10,
    minute: 15
  },
  hosts: ["2dc4fc8194f68a3cbc7c69a3","2dc4fc8194f68a3cbc7c69a4"],
  participants: [], // empty because this is region-wide
  links: [{
      text: "Carol's Room",
      type: "adobe-connect",
      url: "http://zulip.com/carols-room",
    },{
      text: "Daniel's Room",
      type: "adobe-connect",
      url: "http://zulip.com/daniels-room",
  }]
}
```

| Property         | Type         | Description                                                                                 |
| ---------------- | ------------ | ------------------------------------------------------------------------------------------- |
| name             | string       | Name displayed to user                                                                      |
| description      | string       | Description of `schedule-item`                                                              |
| note             | string       | Used for info like 'optional' or 'required for a week';                                     |
| region           | objectId     | Specifies `region`-wide `schedule-item` (only if no participants are listed)                |
| days             | string       | Day(s) when this `schedule-item` should show up on a schedule (can list all seven (7) days) |
| startTime        | object       | Grouping of starting hour and minute                                                        |
| startTime.hour   | string       | Starting hour; 0-23                                                                         |
| startTime.minute | string       | Starting minute; 0-59                                                                       |
| endTime          | object       | Grouping of ending hour and minute                                                          |
| endTime.hour     | string       | Starting hour; 0-23                                                                         |
| endTime.minute   | string       | Starting minute; 0-59                                                                       |
| hosts            | [ objectId ] | `Person` or `people` hosting the schedule-item; at least one host must be specified         |
| participants     | [ objectId ] | `Person` or `people` participating in the schedule-item                                     |
| links            | [ objects ]  | Grouping of site links                                                                      |
| _link_.text      | string       | Link text                                                                                   |
| _link_.type      | string       | Type of link (adobe-connect, open-learning)                                                 |
| _link_.url       | string       | Link url                                                                                    |

_NOTE: the `region` and participants fields operate on order of increased specificity. If a `schedule-item` targets an entire `region`, leave the participants array empty - if any participant is listed, the `schedule-item` will only go to the listed participant(s)._
